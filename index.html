<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OMGProfit Free Currency & Forex Signals</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/lipis/flag-icons@7.2.3/css/flag-icons.min.css"/>
    
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="theme-color" content="#ffffff">
    <link rel="shortcut icon" href="/favicon.ico"> 
    <style>
        /* --- White Theme Styles --- */
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            padding: 10px; 
            background: #ffffff; /* White Background */
            color: #333333; /* Dark Gray Text */
            min-height: 100vh;
            display: flex; 
            flex-direction: column;
        }
        h1 {
            color: #1a1a1a;
            font-weight: 400;
            font-size: 1.8em; 
            margin-bottom: 5px;
        }
        /* Table Container */
        .table-container {
            overflow-x: auto; 
            max-width: 100%;
            margin: 0 auto;
            flex-grow: 1; 
        }
        table { 
            border-collapse: collapse; 
            width: 100%; 
            min-width: 950px; 
            max-width: 1400px; 
            margin: 20px auto; 
            background: #f7f7f7; 
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); 
            table-layout: fixed;
            border-radius: 8px;
            overflow: hidden; 
        }
        th, td { 
            border: 1px solid #e0e0e0; 
            padding: 8px 4px; 
            text-align: center; 
            color: #333333; 
            font-size: 0.8em; 
            white-space: nowrap; 
            overflow: hidden; 
            text-overflow: ellipsis;
            transition: background-color 0.3s; 
        }
        /* General Header Style */
        th { 
            background-color: white; 
            color: black; 
            font-weight: 600;
            text-transform: uppercase;
        }
        /* Alternating row color */
        tr:nth-child(even) {background-color: #eeeeee;} 
        
        /* Currency Display */
        .currency-cell {
            text-transform: uppercase;
            font-weight: bold;
        }

        /* --- STICKY COLUMN (Currency) --- */
        .table-container {
            position: relative; 
        }
        th:first-child,
        td:first-child {
            position: sticky;
            left: 0;
            z-index: 2; 
        }
        
        /* Currency header matches general header (white background, black text) */
        th:first-child {
            background-color: white; 
            color: black;            
        }
        
        /* Sticky data cells remain light gray to stand out from other cells */
        td:first-child {
            background-color: #f0f0f0; 
        }
        tr:nth-child(even) td:first-child {
            background-color: #e5e5e5; 
        }
        
        /* --- Status Cell Styles (Apply directly to TD) --- */
        
        /* BUY: Blue (High Contrast) */
        td.status-buy { 
            background-color: #2c7be5 !important; 
            color: white; 
            font-weight: bold;
        } 
        
        /* SELL: Red (High Contrast) */
        td.status-sell { 
            background-color: #ff3366 !important; 
            color: white; 
            font-weight: bold;
        } 
        
        /* HOLD: No Color (Uses default light background, text is dark gray) */
        td.status-hold { 
            background-color: transparent !important; 
            color: #333333; 
        } 
        
        td.status-default { 
            background-color: #aaaaaa !important; 
            color: white;
        } 
        
        /* Filter Button (Adjusted for white background) */
        #filter-container {
            text-align: center;
            margin: 20px auto 10px auto; 
            max-width: 1400px; 
        }
        .filter-button {
            padding: 8px 10px; 
            border: 1px solid #ccc;
            background-color: #ffffff; 
            color: #333333;
            cursor: pointer;
            border-radius: 4px;
            font-size: 0.8em;
        }
        .filter-button.active {
            background-color: #2c7be5; 
            color: white;
            box-shadow: 0 0 8px rgba(44, 123, 229, 0.4);
            font-weight: bold;
            border-color: #2c7be5;
        }
        
        /* Flag Styling */
        .fi {
            margin-right: 5px;
            vertical-align: middle;
            line-height: 1; 
        }

        /* --- AdSense Placeholder Styling (Optional but helpful) --- */
        .ad-placeholder {
            max-width: 1400px;
            margin: 10px auto;
            padding: 15px;
            text-align: center;
            border: 1px dashed #cccccc;
            background-color: #f9f9f9;
            color: #666;
            font-size: 0.9em;
        }

        /* --- New Footer Styles --- */
        footer {
            max-width: 1400px;
            margin: 20px auto 10px auto;
            padding: 15px;
            text-align: center;
            font-size: 0.75em;
            color: #666;
            border-top: 1px solid #eee;
        }
        footer p {
            margin: 5px 0;
        }

        /* !!! IMPORTANT: STYLES FOR THE DISCLAIMER !!! */
        .disclaimer-text {
            color: #cc0000; /* Bright Red Color */
            font-size: 1.1em; /* Larger than default footer text (0.75em * 1.1 = good size) */
            font-weight: 600; /* Bold the text */
        }

        /* --- Mobile Responsiveness --- */
        @media (max-width: 650px) {
            body { padding: 10px; }
            h1 { font-size: 1.5em; margin-top: 10px; }
            table { min-width: 700px; } 
        }
    </style>
</head>
<body>
    <h1 style="text-align:center;">OMGProfit Free Currency & Forex Signals</h1>
    
    <div class="ad-placeholder">
        **AdSense Code Block 1 (Top Banner)**
        <p>Paste your AdSense code here.</p>
    </div>
    <div id="filter-container">
        <button class="filter-button active" data-timeframe="all">Forex</button>
    </div>

    <div class="table-container">
        <table id="currency-table">
            <thead>
                <tr>
                    <th data-column="Currency">Currency</th>
                    <th data-column="1-Hourly">1H</th>
                    <th data-column="2-Hourly">2H</th>
                    <th data-column="3-Hourly">3H</th>
                    <th data-column="4-Hourly">4H</th>
                    <th data-column="6-Hourly">6H</th>
                    <th data-column="8-Hourly">8H</th>
                    <th data-column="12-Hourly">12H</th>
                    <th data-column="Daily">D</th>
                    <th data-column="Weekly">W</th>
                    <th data-column="Monthly">M</th>
                    <th data-column="Status" data-is-static="true">Status</th>
                </tr>
            </thead>
            <tbody>
                <tr><td colspan="12" class="loading">Initializing...</td></tr> 
            </tbody>
        </table>
    </div>
    
    <div class="ad-placeholder">
        **AdSense Code Block 2 (Mid-Page/Rectangle)**
        <p>Paste your AdSense code here.</p>
    </div>
    <div class="ad-placeholder">
        **AdSense Code Block 3 (Bottom/Link Unit)**
        <p>Paste your AdSense code here.</p>
    </div>
    <footer>
        <p>&copy; Copyright OMGProfit 2025. All Rights Reserved.</p>
        <p class="disclaimer-text">
            **Risk Disclaimer:** Trading foreign exchange (Forex) and/or Contracts for Difference (CFDs) on margin carries a high level of risk, and may not be suitable for all investors. The high degree of leverage can work against you as well as for you. Before deciding to trade Forex/CFDs, you should carefully consider your investment objectives, level of experience, and risk appetite. The signals provided on this website are for informational purposes only and do not constitute financial advice. Past performance is not indicative of future results.
        </p>
    </footer>
    <script>
        // --- Configuration ---
        // !!! SET TO TRUE FOR LIVE DEPLOYMENT VIA NETLIFY PROXY !!!
        const USE_LIVE_PROXY = true; 
        const CSV_PROXY_URL = "/.netlify/functions/fetch-csv"; 
        const REFRESH_INTERVAL = 5 * 60 * 1000; // 5 minutes refresh
        
        const TIME_FRAME_COLUMNS = [
            { name: "Currency", index: 0, filterable: false },
            { name: "1-Hourly", index: 1, filterable: true },
            { name: "2-Hourly", index: 2, filterable: true },
            { name: "3-Hourly", index: 3, filterable: true },
            { name: "4-Hourly", index: 4, filterable: true },
            { name: "6-Hourly", index: 5, filterable: true },
            { name: "8-Hourly", index: 6, filterable: true },
            { name: "12-Hourly", index: 7, filterable: true },
            { name: "Daily", index: 8, filterable: true },
            { name: "Weekly", index: 9, filterable: true },
            { name: "Monthly", index: 10, filterable: true },
            { name: "Status", index: 11, filterable: false }
        ];
        const EXPECTED_COLUMNS = TIME_FRAME_COLUMNS.length; 
        const STATUS_COLUMN_INDEX = TIME_FRAME_COLUMNS.findIndex(col => col.name === "Status");
        const CURRENCY_COLUMN_INDEX = TIME_FRAME_COLUMNS.findIndex(col => col.name === "Currency");
        
        let activeTimeframe = 'all'; 

        // --- Currency to Flag Mapping ---
        const CURRENCY_TO_FLAG = {
            'EUR': 'eu',
            'USD': 'us',
            'GBP': 'gb',
            'JPY': 'jp',
            'AUD': 'au',
            'NZD': 'nz',
            'CAD': 'ca',
            'CHF': 'ch',
            'XAU': 'au', 
            'XAG': 'us' 
        };
        
        // --- MOCK DATA FUNCTION (Included for completeness) ---
        function fetchMockCSV() {
            console.warn("--- Fetching MOCK data for local testing ---");
            const mockData = 
`Currency,1-Hourly,2-Hourly,3-Hourly,4-Hourly,6-Hourly,8-Hourly,12-Hourly,Daily,Weekly,Monthly,Overall Status
EURUSD,BUY,HOLD,BUY,SELL,HOLD,BUY,SELL,HOLD,SELL,BUY,HOLD
GBPUSD,SELL,BUY,HOLD,BUY,SELL,HOLD,BUY,BUY,BUY,SELL,BUY
USDJPY,HOLD,SELL,BUY,HOLD,BUY,SELL,HOLD,SELL,BUY,HOLD,SELL
AUDCAD,BUY,HOLD,SELL,BUY,HOLD,SELL,BUY,BUY,HOLD,SELL,BUY
EURGBP,SELL,BUY,HOLD,SELL,BUY,HOLD,SELL,HOLD,BUY,SELL,HOLD
NZDCAD,BUY,BUY,BUY,HOLD,HOLD,SELL,SELL,BUY,HOLD,SELL,BUY
XAUUSD,BUY,SELL,BUY,HOLD,BUY,SELL,HOLD,SELL,BUY,HOLD,SELL
USDCHF,HOLD,HOLD,BUY,SELL,BUY,HOLD,SELL,BUY,SELL,BUY,HOLD
GBPJPY,SELL,BUY,HOLD,BUY,SELL,HOLD,BUY,BUY,BUY,SELL,BUY
CADCHF,HOLD,SELL,BUY,HOLD,BUY,SELL,HOLD,SELL,BUY,HOLD,SELL`; 

            return Promise.resolve(mockData);
        }

        // --- LIVE DATA FETCH (Active when USE_LIVE_PROXY is true) ---
        async function fetchLiveCSV() {
            try {
                const response = await fetch(CSV_PROXY_URL);
                if (!response.ok) {
                    const errorBody = await response.json().catch(() => ({ error: 'Unknown server error.' }));
                    throw new Error(`Proxy error: ${response.status} - ${errorBody.error}`);
                }
                return await response.text();
            } catch (err) {
                console.error("Error fetching data from proxy:", err.message);
                document.querySelector("#currency-table tbody").innerHTML = 
                    `<tr><td colspan="${EXPECTED_COLUMNS}" style="color:red;">Error loading data: ${err.message}</td></tr>`;
                return "";
            }
        }
        
        // --- Main Fetch Function: Chooses between Live and Mock ---
        async function fetchCSV() {
            if (USE_LIVE_PROXY) {
                return fetchLiveCSV();
            } else {
                return fetchMockCSV();
            }
        }

        function parseCSV(csvText) {
            const rows = csvText.trim().split(/\r?\n/);
            return rows.map(row => row.split(","));
        }

        // Returns status class based on the signal
        function getStatusClass(status) {
            const cleanedStatus = status.trim().toLowerCase();
            if (cleanedStatus.includes('buy')) return 'status-buy';
            if (cleanedStatus.includes('sell')) return 'status-sell';
            if (cleanedStatus.includes('hold')) return 'status-hold';
            return 'status-default';
        }
        
        // --- Flag & Currency Renderer ---
        function createCurrencyCell(currencyPair) {
            const td = document.createElement("td");
            td.classList.add('currency-cell');
            
            const baseCurrency = currencyPair.substring(0, 3).toUpperCase();
            const quoteCurrency = currencyPair.substring(3, 6).toUpperCase();
            
            let htmlContent = '';

            const flag1 = CURRENCY_TO_FLAG[baseCurrency];
            if (flag1) {
                htmlContent += `<span class="fi fi-${flag1}"></span>`;
            }
            htmlContent += baseCurrency;
            
            htmlContent += '/';

            const flag2 = CURRENCY_TO_FLAG[quoteCurrency];
            if (flag2) {
                htmlContent += `<span class="fi fi-${flag2}"></span>`;
            }
            htmlContent += quoteCurrency;
            
            td.innerHTML = htmlContent;
            return td;
        }

        function renderTable(data) {
            const tbody = document.querySelector("#currency-table tbody");
            tbody.innerHTML = "";
            
            data.forEach((row, index) => {
                if (index === 0) return; 
                
                if (row.length < EXPECTED_COLUMNS) { 
                    console.warn(`Skipping malformed row (expected ${EXPECTED_COLUMNS} columns): ${row.join(',')}`);
                    return; 
                }

                const tr = document.createElement("tr");
                
                row.slice(0, EXPECTED_COLUMNS).forEach((cell, cellIndex) => { 
                    const cellValue = cell.trim();
                    
                    if (cellIndex === CURRENCY_COLUMN_INDEX) {
                        const currencyTd = createCurrencyCell(cellValue);
                        tr.appendChild(currencyTd);
                        return; 
                    } 
                    
                    const td = document.createElement("td");
                    td.textContent = cellValue;
                    
                    // Apply color class to all signal columns and the final Status column
                    if (cellIndex > CURRENCY_COLUMN_INDEX) {
                        const statusClass = getStatusClass(cellValue);
                        td.classList.add(statusClass);
                    }

                    tr.appendChild(td);
                });
                tbody.appendChild(tr);
            });
            
            // Updates the ALL button state (which is always active now)
            applyFilter(activeTimeframe);
            
            const now = new Date().toLocaleTimeString();
            const captionText = `Last Updated: ${now} JST`;
            let caption = document.querySelector("#currency-table caption");
            if (!caption) {
                caption = document.createElement("caption");
                document.getElementById("currency-table").appendChild(caption);
            }
            caption.textContent = captionText;
        }
        
        // --- Filter Logic (Simplified - only handles 'all') ---
        function applyFilter(timeframe) {
            document.querySelectorAll('.filter-button').forEach(button => {
                if (button.getAttribute('data-timeframe') === 'all') {
                    button.classList.add('active');
                } else {
                    button.classList.remove('active');
                }
            });
        }

        async function updateTable() {
            document.querySelector("#currency-table tbody").innerHTML = 
                `<tr><td colspan="${EXPECTED_COLUMNS}" class="loading">Fetching and processing data...</td></tr>`;
            
            const csvText = await fetchCSV();
            
            if (csvText) {
                const data = parseCSV(csvText);
                if (data.length > 1) { 
                    renderTable(data);
                } else {
                    document.querySelector("#currency-table tbody").innerHTML = 
                        `<tr><td colspan="${EXPECTED_COLUMNS}" style="color:#FFC300;">Data is empty or incorrectly formatted.</td></tr>`;
                }
            }
        }
        
        // --- Initialization ---
        function init() {
            updateTable();
            
            // Set interval only if using the live proxy
            if (USE_LIVE_PROXY) {
                setInterval(updateTable, REFRESH_INTERVAL);
            }
        }
        
        init();
    </script>
</body>
</html>